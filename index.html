<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>REDA WORLD - Phase 5 (COMBAT)</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; z-index: 10; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">
        <b>REDA WORLD - Phase 5</b><br>
        النقاط (Kills): <span id="kills">0</span><br>
        التحكم: انقر بالفأرة (Click) للهجوم ⚔️
    </div>
    <div id="crosshair"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        window.onload = () => {
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));

            // الأرضية
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshPhongMaterial({color: 0x348C31}));
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // اللاعب
            const player = new THREE.Group();
            const pBody = new THREE.Mesh(new THREE.BoxGeometry(0.6, 1.5, 0.4), new THREE.MeshPhongMaterial({color: 0x0066ff}));
            pBody.position.y = 0.75;
            player.add(pBody);
            
            // السيف (أداة القتال)
            const sword = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 1), new THREE.MeshPhongMaterial({color: 0xcccccc}));
            sword.position.set(0.4, 0.8, -0.6);
            player.add(sword);
            scene.add(player);

            // نظام الأعداء
            const enemies = [];
            let killCount = 0;

            function spawnEnemy() {
                const enemy = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), new THREE.MeshPhongMaterial({color: 0xff0000}));
                enemy.position.set(Math.random()*40-20, 0.5, Math.random()*40-20);
                scene.add(enemy);
                enemies.push(enemy);
            }
            for(let i=0; i<10; i++) spawnEnemy();

            const keys = {};
            window.onkeydown = (e) => keys[e.code] = true;
            window.onkeyup = (e) => keys[e.code] = false;

            // الهجوم
            window.onclick = () => {
                // تحريك السيف كأنه كيضرب
                sword.rotation.x = -Math.PI / 4;
                setTimeout(() => sword.rotation.x = 0, 100);

                // فحص التصادم مع الأعداء اللي قدام اللاعب
                enemies.forEach((enemy, index) => {
                    const dist = player.position.distanceTo(enemy.position);
                    if(dist < 3) {
                        scene.remove(enemy);
                        enemies.splice(index, 1);
                        killCount++;
                        document.getElementById('kills').innerText = killCount;
                        spawnEnemy(); // زيد عدو جديد ملي كيموت واحد
                    }
                });
            };

            function animate() {
                requestAnimationFrame(animate);
                if (keys['KeyW']) player.translateZ(-0.2);
                if (keys['KeyS']) player.translateZ(0.2);
                if (keys['KeyA']) player.rotation.y += 0.05;
                if (keys['KeyD']) player.rotation.y -= 0.05;

                // الأعداء كيتحركو شوية بشكل عشوائي
                enemies.forEach(enemy => {
                    enemy.rotation.y += 0.02;
                });

                const offset = new THREE.Vector3(0, 5, 10).applyMatrix4(player.matrixWorld);
                camera.position.lerp(offset, 0.1);
                camera.lookAt(player.position.x, player.position.y + 1, player.position.z);

                renderer.render(scene, camera);
            }
            animate();
        };
    </script>
</body>
</html>
