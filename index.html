<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>REDA MEGA PROJECT - PRO ANIMATION</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: #0f0; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border: 1px solid #0f0; z-index: 10; }
        #hp-bar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 200px; height: 15px; background: #333; border: 2px solid #fff; }
        #hp-fill { width: 100%; height: 100%; background: #0f0; transition: 0.2s; }
    </style>
</head>
<body>
    <div id="ui"><b>REDA WORLD v1.1</b><br>KILLS: <span id="score">0</span></div>
    <div id="hp-bar"><div id="hp-fill"></div></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, playerHP = 100, score = 0;
        let enemies = [], keys = {}, walkCycle = 0;

        function createCharacter(isEnemy = false) {
            const group = new THREE.Group();
            const color = isEnemy ? 0xff2222 : 0x0088ff;
            const mat = new THREE.MeshPhongMaterial({color: color});

            // الجسد
            const torso = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.8, 0.3), mat);
            torso.position.y = 1.1;
            group.add(torso);

            // الرأس
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.4, 0.4), new THREE.MeshPhongMaterial({color: 0xffdbac}));
            head.position.y = 1.7;
            group.add(head);

            // اليدين (مع مفاصل)
            const armL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.7, 0.2), mat);
            armL.position.set(0.45, -0.3, 0);
            const armLGroup = new THREE.Group();
            armLGroup.position.set(0, 1.4, 0);
            armLGroup.add(armL);
            group.add(armLGroup);

            const armR = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.7, 0.2), mat);
            armR.position.set(-0.45, -0.3, 0);
            const armRGroup = new THREE.Group();
            armRGroup.position.set(0, 1.4, 0);
            armRGroup.add(armR);
            group.add(armRGroup);

            // الرجلين
            const legL = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.7, 0.25), mat);
            legL.position.y = -0.35;
            const legLGroup = new THREE.Group();
            legLGroup.position.set(0.15, 0.7, 0);
            legLGroup.add(legL);
            group.add(legLGroup);

            const legR = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.7, 0.25), mat);
            legR.position.y = -0.35;
            const legRGroup = new THREE.Group();
            legRGroup.position.set(-0.15, 0.7, 0);
            legRGroup.add(legR);
            group.add(legRGroup);

            // السيف (فقط للاعب)
            let sword = null;
            if(!isEnemy) {
                sword = new THREE.Mesh(new THREE.BoxGeometry(0.1, 1.2, 0.1), new THREE.MeshPhongMaterial({color: 0xffcc00}));
                sword.position.set(0, -0.7, -0.4);
                sword.rotation.x = Math.PI / 2;
                armRGroup.add(sword);
            }

            return { group, armLGroup, armRGroup, legLGroup, legRGroup, sword };
        }

        window.onload = () => {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));
            scene.add(new THREE.GridHelper(100, 40, 0x00ff00, 0x222222));

            player = createCharacter(false);
            scene.add(player.group);

            function spawnEnemy() {
                const e = createCharacter(true);
                e.group.position.set(Math.random()*40-20, 0, Math.random()*40-20);
                e.lastHit = 0;
                enemies.push(e);
                scene.add(e.group);
            }
            for(let i=0; i<4; i++) spawnEnemy();

            window.onkeydown = (e) => keys[e.code] = true;
            window.onkeyup = (e) => keys[e.code] = false;

            let isAttacking = false;
            window.onclick = () => {
                if(isAttacking) return;
                isAttacking = true;
                // أنيميشن الضرب
                let startTime = Date.now();
                const attackInt = setInterval(() => {
                    let elapsed = Date.now() - startTime;
                    player.armRGroup.rotation.x = -Math.sin(elapsed * 0.01) * 2;
                    if(elapsed > 300) {
                        clearInterval(attackInt);
                        player.armRGroup.rotation.x = 0;
                        isAttacking = false;
                    }
                }, 16);

                enemies.forEach((enemy, index) => {
                    if(player.group.position.distanceTo(enemy.group.position) < 3) {
                        scene.remove(enemy.group);
                        enemies.splice(index, 1);
                        score++;
                        document.getElementById('score').innerText = score;
                        spawnEnemy();
                    }
                });
            };

            function animate() {
                requestAnimationFrame(animate);
                let moving = false;
                if(keys['KeyW']) { player.group.translateZ(-0.15); moving = true; }
                if(keys['KeyS']) { player.group.translateZ(0.15); moving = true; }
                if(keys['KeyA']) player.group.rotation.y += 0.05;
                if(keys['KeyD']) player.group.rotation.y -= 0.05;

                // أنيميشن المشي
                if(moving) {
                    walkCycle += 0.15;
                    player.legLGroup.rotation.x = Math.sin(walkCycle) * 0.5;
                    player.legRGroup.rotation.x = -Math.sin(walkCycle) * 0.5;
                    player.armLGroup.rotation.x = -Math.sin(walkCycle) * 0.5;
                    if(!isAttacking) player.armRGroup.rotation.x = Math.sin(walkCycle) * 0.5;
                } else {
                    player.legLGroup.rotation.x = 0;
                    player.legRGroup.rotation.x = 0;
                    player.armLGroup.rotation.x = 0;
                }

                // ذكاء الأعداء
                enemies.forEach(enemy => {
                    const dist = player.group.position.distanceTo(enemy.group.position);
                    if(dist < 15) {
                        enemy.group.lookAt(player.group.position);
                        enemy.group.translateZ(0.06);
                        // أنيميشن مشي العدو
                        enemy.legLGroup.rotation.x = Math.sin(Date.now()*0.01) * 0.5;
                        enemy.legRGroup.rotation.x = -Math.sin(Date.now()*0.01) * 0.5;
                        
                        if(dist < 1.5 && Date.now() - enemy.lastHit > 1000) {
                            playerHP -= 10;
                            enemy.lastHit = Date.now();
                            document.getElementById('hp-fill').style.width = playerHP + "%";
                            if(playerHP <= 0) location.reload();
                        }
                    }
                });

                camera.position.lerp(new THREE.Vector3(0, 5, 10).applyMatrix4(player.group.matrixWorld), 0.1);
                camera.lookAt(player.group.position.x, player.group.position.y + 1, player.group.position.z);
                renderer.render(scene, camera);
            }
            animate();
        };
    </script>
</body>
</html>
