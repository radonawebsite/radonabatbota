<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>REDA MEGA PROJECT - FULL COMBAT</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: #fff; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border-left: 5px solid #00f2ff; z-index: 10; }
        #health-container { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 250px; height: 20px; background: #333; border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
        #health-fill { width: 100%; height: 100%; background: #00ff00; transition: 0.2s; }
        #death-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,0,0,0.5); display: none; justify-content: center; align-items: center; color: white; font-size: 50px; flex-direction: column; z-index: 100; }
    </style>
</head>
<body>
    <div id="ui">
        <b>REDA WARRIOR v1.0</b><br>
        الضحايا: <span id="score">0</span>
    </div>
    <div id="health-container"><div id="health-fill"></div></div>
    <div id="death-screen">
        لقد مت! <br>
        <button onclick="location.reload()" style="padding: 10px 20px; font-size: 20px; cursor: pointer;">إعادة المحاولة</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, playerHP = 100, score = 0;
        let enemies = [], keys = {};

        function createHumanoid(color) {
            const group = new THREE.Group();
            const mat = new THREE.MeshPhongMaterial({color: color});
            // الرأس، الجسد، الأطراف
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.4, 0.4), new THREE.MeshPhongMaterial({color: 0xffdbac}));
            head.position.y = 1.6;
            const torso = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.8, 0.3), mat);
            torso.position.y = 1.0;
            const armL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.7, 0.2), mat);
            armL.position.set(0.45, 1.0, 0);
            const armR = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.7, 0.2), mat);
            armR.position.set(-0.45, 1.0, 0);
            const legL = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.7, 0.25), mat);
            legL.position.set(0.15, 0.3, 0);
            const legR = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.7, 0.25), mat);
            legR.position.set(-0.15, 0.3, 0);
            group.add(head, torso, armL, armR, legL, legR);
            return group;
        }

        window.onload = () => {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));
            scene.add(new THREE.GridHelper(100, 20, 0x00f2ff, 0x222222));

            // إنشاء اللاعب
            player = createHumanoid(0x0066ff);
            scene.add(player);

            // إنشاء الأعداء
            function spawnEnemy() {
                const enemy = createHumanoid(0xff0000);
                enemy.position.set(Math.random()*40-20, 0, Math.random()*40-20);
                enemy.userData = { lastHit: 0 };
                scene.add(enemy);
                enemies.push(enemy);
            }
            for(let i=0; i<3; i++) spawnEnemy();

            window.onkeydown = (e) => keys[e.code] = true;
            window.onkeyup = (e) => keys[e.code] = false;

            window.onclick = () => {
                enemies.forEach((enemy, index) => {
                    if(player.position.distanceTo(enemy.position) < 3) {
                        scene.remove(enemy);
                        enemies.splice(index, 1);
                        score++;
                        document.getElementById('score').innerText = score;
                        spawnEnemy();
                    }
                });
            };

            function animate() {
                if(playerHP <= 0) return;
                requestAnimationFrame(animate);

                // حركة اللاعب
                if(keys['KeyW']) player.translateZ(-0.15);
                if(keys['KeyS']) player.translateZ(0.15);
                if(keys['KeyA']) player.rotation.y += 0.05;
                if(keys['KeyD']) player.rotation.y -= 0.05;

                // منطق الأعداء
                enemies.forEach(enemy => {
                    const dist = player.position.distanceTo(enemy.position);
                    if(dist < 10) {
                        const dir = new THREE.Vector3().subVectors(player.position, enemy.position).normalize();
                        enemy.position.addScaledVector(dir, 0.04);
                        enemy.lookAt(player.position);
                        
                        // الهجوم (إذا كان العدو قريباً جداً)
                        if(dist < 2 && Date.now() - enemy.userData.lastHit > 1000) {
                            playerHP -= 10;
                            enemy.userData.lastHit = Date.now();
                            document.getElementById('health-fill').style.width = playerHP + "%";
                            if(playerHP <= 0) document.getElementById('death-screen').style.display = 'flex';
                        }
                    }
                });

                camera.position.lerp(new THREE.Vector3(0, 5, 8).applyMatrix4(player.matrixWorld), 0.1);
                camera.lookAt(player.position.x, player.position.y + 1, player.position.z);
                renderer.render(scene, camera);
            }
            animate();
        };
    </script>
</body>
</html>
