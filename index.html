<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Roblox Web Studio</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #gui { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px; pointer-events: none; border: 1px solid #444; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    </style>
</head>
<body>

<div id="gui">
    <b style="color: #ff3e3e;">ROBLOX JS ENGINE</b><br>
    • WASD: Move<br>
    • SPACE: Jump<br>
    • CLICK: Lock Mouse & Control Camera
</div>
<div id="crosshair"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
    // 1. الإعدادات الأساسية
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x8ebcf3); // لون السماء التقليدي
    
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // 2. إضاءة الاستوديو
    const sun = new THREE.DirectionalLight(0xffffff, 1.2);
    sun.position.set(50, 100, 50);
    sun.castShadow = true;
    scene.add(sun);
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));

    // 3. الـ Baseplate (قلب روبلوكس)
    const grid = new THREE.GridHelper(200, 40, 0x888888, 0x444444);
    scene.add(grid);

    const floor = new THREE.Mesh(
        new THREE.PlaneGeometry(200, 200),
        new THREE.MeshStandardMaterial({ color: 0x999999 })
    );
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

    // 4. اللاعب (The Character Model)
    const player = new THREE.Group();
    const mat = new THREE.MeshStandardMaterial({ color: 0x2196f3 });
    const body = new THREE.Mesh(new THREE.BoxGeometry(1, 1.5, 0.6), mat);
    body.position.y = 1.25;
    body.castShadow = true;
    player.add(body);

    const head = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.6, 0.6), new THREE.MeshStandardMaterial({color: 0xffdbac}));
    head.position.y = 2.4;
    player.add(head);

    scene.add(player);
    player.position.set(0, 0, 0);

    // 5. نظام الكاميرا والتحكم (Pointer Lock)
    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
    let canJump = false;
    let velocity = new THREE.Vector3();
    let direction = new THREE.Vector3();

    document.addEventListener('click', () => renderer.domElement.requestPointerLock());
    
    document.addEventListener('mousemove', (e) => {
        if (document.pointerLockElement === renderer.domElement) {
            player.rotation.y -= e.movementX * 0.002;
            // الكاميرا كتميل للفوق وللتحت (Pitch)
            camera.rotation.x -= e.movementY * 0.002;
            camera.rotation.x = Math.max(-Math.PI/3, Math.min(Math.PI/3, camera.rotation.x));
        }
    });

    const onKeyDown = (e) => {
        switch (e.code) {
            case 'KeyW': moveForward = true; break;
            case 'KeyS': moveBackward = true; break;
            case 'KeyA': moveLeft = true; break;
            case 'KeyD': moveRight = true; break;
            case 'Space': if (canJump) velocity.y += 0.25; canJump = false; break;
        }
    };

    const onKeyUp = (e) => {
        switch (e.code) {
            case 'KeyW': moveForward = false; break;
            case 'KeyS': moveBackward = false; break;
            case 'KeyA': moveLeft = false; break;
            case 'KeyD': moveRight = false; break;
        }
    };

    document.addEventListener('keydown', onKeyDown);
    document.addEventListener('keyup', onKeyUp);

    // 6. محرك التحديث (Game Loop)
    const clock = new THREE.Clock();

    function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();

        // فيزياء الحركة
        velocity.x -= velocity.x * 10.0 * delta;
        velocity.z -= velocity.z * 10.0 * delta;
        velocity.y -= 0.8 * delta; // الجاذبية

        direction.z = Number(moveForward) - Number(moveBackward);
        direction.x = Number(moveRight) - Number(moveLeft);
        direction.normalize();

        if (moveForward || moveBackward) velocity.z -= direction.z * 100.0 * delta;
        if (moveLeft || moveRight) velocity.x -= direction.x * 100.0 * delta;

        player.translateX(-velocity.x * delta);
        player.translateZ(velocity.z * delta);
        player.position.y += velocity.y;

        if (player.position.y < 0) {
            velocity.y = 0;
            player.position.y = 0;
            canJump = true;
        }

        // تثبيت الكاميرا خلف اللاعب (Orbit Follow)
        const cameraOffset = new THREE.Vector3(0, 3, 8).applyQuaternion(player.quaternion);
        camera.position.copy(player.position).add(cameraOffset);
        camera.lookAt(player.position.x, player.position.y + 1.5, player.position.z);

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
</script>
</body>
</html>
