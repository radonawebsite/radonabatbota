<!DOCTYPE html>
<html>
<head>
    <title>REDA PROJECT - STEP 3</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; font-family: sans-serif; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; border-left: 4px solid #ffcc00; }
    </style>
</head>
<body>
    <div id="ui">
        <b>REDA WORLD - Phase 3</b><br>
        Ø§Ù„ØªØ­ÙƒÙ…: WASD + Space Ù„Ù„Ù‚ÙØ²<br>
        Ø§Ù„Ø­Ø§Ù„Ø©: Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© ÙˆØ§Ù„Ø¨ÙŠØ¦Ø© Ù…ÙØ¹Ù‘Ù„Ø© ğŸŒ³
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        scene.fog = new THREE.Fog(0x87CEEB, 5, 50); // Ø¶Ø¨Ø§Ø¨ Ø¨Ø§Ø´ ÙŠØ¹Ø·ÙŠ Ø¬Ù…Ø§Ù„ÙŠØ© ÙˆØ¨Ø¹Ø¯

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¸Ù„Ø§Ù„
        document.body.appendChild(renderer.domElement);

        // Ø¥Ø¶Ø§Ø¡Ø© Ø´Ù…Ø³ÙŠØ© Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø¸Ù„Ø§Ù„
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(10, 20, 10);
        sun.castShadow = true;
        scene.add(sun, new THREE.AmbientLight(0x707070));

        // Ø§Ù„Ø£Ø±Ø¶ÙŠØ©
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(200, 200), 
            new THREE.MeshPhongMaterial({color: 0x348C31})
        );
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // ØµÙ†Ø¹ "ØºØ§Ø¨Ø©" Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        for(let i=0; i<60; i++) {
            const treeGroup = new THREE.Group();
            const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 1), new THREE.MeshPhongMaterial({color: 0x8B4513}));
            const leaves = new THREE.Mesh(new THREE.ConeGeometry(1, 2, 8), new THREE.MeshPhongMaterial({color: 0x228B22}));
            leaves.position.y = 1.5;
            treeGroup.add(trunk, leaves);
            treeGroup.position.set(Math.random()*100-50, 0.5, Math.random()*100-50);
            scene.add(treeGroup);
        }

        // Ø§Ù„Ù„Ø§Ø¹Ø¨
        const player = new THREE.Group();
        const pBody = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 0.8, 4, 8), new THREE.MeshPhongMaterial({color: 0x0066ff}));
        pBody.position.y = 0.8;
        pBody.castShadow = true;
        player.add(pBody);
        scene.add(player);

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡
        let velocityY = 0;
        let isGrounded = true;
        const keys = {};

        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        function animate() {
            requestAnimationFrame(animate);

            // Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© (Gravity)
            velocityY -= 0.01; 
            player.position.y += velocityY;

            if(player.position.y <= 0) {
                player.position.y = 0;
                velocityY = 0;
                isGrounded = true;
            }

            // Ø§Ù„Ù‚ÙØ²
            if(keys['Space'] && isGrounded) {
                velocityY = 0.2;
                isGrounded = false;
            }

            // Ø§Ù„Ø­Ø±ÙƒØ©
            const speed = 0.15;
            if (keys['KeyW']) player.translateZ(-speed);
            if (keys['KeyS']) player.translateZ(speed);
            if (keys['KeyA']) player.rotation.y += 0.04;
            if (keys['KeyD']) player.rotation.y -= 0.04;

            // ØªØªØ¨Ø¹ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            const offset = new THREE.Vector3(0, 3, 6).applyMatrix4(player.matrixWorld);
            camera.position.lerp(offset, 0.1);
            camera.lookAt(player.position.x, player.position.y + 1, player.position.z);

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
